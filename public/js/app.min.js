"use strict";angular.module("oneImobiliaria",["ui.router","ui.utils.masks"]).run(["$rootScope","$state","RESOURCES","UserService",function(e,r,o,t){return e.error=!1,e.success=!1,e.loading=!1,e.fileUrl=o.API_URL+"/",e.page="",e.name="",e.showMenu=!1,e.showSubmenu=!1,e.appTitle="One Consultoria Imobiliária",e.forms={},e.doLogout=function(){return t.doLogout()},e.toggleMenu=function(){return e.showMenu=!e.showMenu},e.toggleSubmenu=function(){return e.showSubmenu=!e.showSubmenu},e.$on("$stateChangeSuccess",function(){var o;if(o=r.current.name.split("."),e.page=o[1]||"",e.name=localStorage.getItem("name-one")||"",e.error=!1,e.success=!1,e.loading=!1,e.showMenu=!1,e.showSubmenu=!1,r.current.requiredLogin&&!t.isLogged()&&t.doLogout(),!r.current.requiredLogin&&t.isLogged())return r.go("dashboard.home")})}]).constant("RESOURCES",{API_URL:"http://localhost:3000/api"}),angular.module("oneImobiliaria").config(["$stateProvider","$httpProvider","$urlRouterProvider",function(e,r,o){return e.state("login",{url:"/login",views:{main:{templateUrl:"app/views/login/index.html",controller:"LoginCtrl"},"error@login":{templateUrl:"app/views/error.html"}},requiredLogin:!1}).state("dashboard",{url:"/dashboard","abstract":!0,views:{main:{},header:{templateUrl:"app/views/header.html"},footer:{templateUrl:"app/views/footer.html"}},requiredLogin:!0}).state("dashboard.home",{url:"/home",views:{"main@":{templateUrl:"app/views/home/index.html"}},requiredLogin:!0}).state("dashboard.users",{url:"/users",views:{"main@":{templateUrl:"app/views/users/index.html",controller:"UsersCtrl"},"submenu@dashboard.users":{templateUrl:"app/views/users/submenu.html"},"error@dashboard.users":{templateUrl:"app/views/error.html"},"success@dashboard.users":{templateUrl:"app/views/success.html"},"loading@dashboard.users":{templateUrl:"app/views/loading.html"}},requiredLogin:!0}).state("dashboard.users.new",{url:"/new",views:{"main@":{templateUrl:"app/views/users/form.html",controller:"UsersCtrl"},"error@dashboard.users.new":{templateUrl:"app/views/error.html"},"loading@dashboard.users.new":{templateUrl:"app/views/loading.html"}},requiredLogin:!0}).state("dashboard.users.edit",{url:"/edit/:id",views:{"main@":{templateUrl:"app/views/users/form.html",controller:"UsersCtrl"},"error@dashboard.users.edit":{templateUrl:"app/views/error.html"},"loading@dashboard.users.edit":{templateUrl:"app/views/loading.html"}},requiredLogin:!0}).state("dashboard.properties",{url:"/properties",views:{"main@":{templateUrl:"app/views/properties/index.html"},"submenu@dashboard.properties":{templateUrl:"app/views/properties/submenu.html"}},requiredLogin:!0}),o.otherwise("/login"),r.interceptors.push("sessionInjector"),r.defaults.useXDomain=!0,r.defaults.headers.common["Content-Type"]="application/json",delete r.defaults.headers.common["X-Requested-With"]}]),angular.module("oneImobiliaria").service("$loading",["$rootScope",function(e){return{show:function(){return e.loading=!0},hide:function(){return e.loading=!1}}}]),angular.module("oneImobiliaria").service("$logger",["$rootScope",function(e){return{clean:function(){return e.success=!1,e.error=!1,e.modalError=!1},error:function(r){return this.clean(),e.error=r},modalError:function(r){return this.clean(),e.modalError=r},success:function(r){return this.clean(),e.success=r}}}]),angular.module("oneImobiliaria").service("sessionInjector",["storage",function(e){var r;return r=function(e){return e.url.indexOf("auth")>-1||e.url.indexOf("remember")>-1},{request:function(o){return r(o)||(o.headers["x-access-token"]=e.getSessionToken()),o}}}]),angular.module("oneImobiliaria").service("storage",function(){return{isLogged:function(){return null!==localStorage.getItem("x-code-one")&&null!==localStorage.getItem("code-one")},setCodes:function(e){return localStorage.setItem("x-code-one",e.token),localStorage.setItem("code-one",e.code),localStorage.setItem("group-one",e.type),localStorage.setItem("name-one",e.name)},getSessionToken:function(){return localStorage.getItem("x-code-one")},getCode:function(){return localStorage.getItem("code-one")},clean:function(){return localStorage.removeItem("x-code-one"),localStorage.removeItem("code-one"),localStorage.removeItem("group-one"),localStorage.removeItem("name-one")}}}),angular.module("oneImobiliaria").service("UserGroupService",function(){var e;return e=[{title:"Administrador(a)",code:"admin"},{title:"Corretor(a)",code:"broker"}],{getAll:function(){return e}}}),angular.module("oneImobiliaria").service("UserService",["$http","$state","storage","RESOURCES",function(e,r,o,t){var n;return n=t.API_URL+"/accounts",{isLogged:function(){return o.isLogged()},doLogin:function(r){return e.post(n+"/auth",r)},doLogout:function(){o.clean(),r.go("login")},create:function(r){return e.post(n,r)},update:function(r){return e.put(n+"/"+r._id,r)},saveOrUpdate:function(e){return e._id?this.update(e):this.create(e)},getAll:function(){return e.get(n)},get:function(r){return e.get(n+"/"+r)},"delete":function(r){return e["delete"](n+"/"+r)}}}]),angular.module("oneImobiliaria").filter("firstName",function(){return function(e){var r;return null==e||""===e?"":(r=e.split(" "),r[0])}}),angular.module("oneImobiliaria").filter("groupName",function(){return function(e){var r,o;return null==e||""===e?"":(r=[{title:"Administrador(a)",code:"admin"},{title:"Corretor(a)",code:"broker"}],o="",r.map(function(r){if(r.code===e)return o=r.title}),o)}}),angular.module("oneImobiliaria").directive("file",function(){return{require:"ngModel",restrict:"A",link:function(e,r,o,t){var n;return n=function(r){var o,n;return n=r.target.files,o=n[0],t.$setViewValue(o),e.$apply()},r.bind("change",n)}}}),angular.module("oneImobiliaria").controller("LoginCtrl",["$scope","$rootScope","$state","$logger","storage","UserService",function(e,r,o,t,n,a){return e.user={},e.doLogin=function(){return r.forms.login.$valid?(e.user.origin="admin",a.doLogin(e.user).then(function(e){return n.setCodes(e.data),o.go("dashboard.home")})["catch"](function(e){return t.error("Usuário e/ou senha inválido(s).")})):void t.error("Preencha todos os dados obrigatórios.")}}]),angular.module("oneImobiliaria").controller("UsersCtrl",["$scope","$rootScope","$state","$stateParams","$filter","$loading","$logger","storage","UserGroupService","UserService",function(e,r,o,t,n,a,i,u,s,l){return e.user={},e.users=[],e.groups=s.getAll(),e.edit=!0,a.show(),t.id?l.get(t.id).then(function(r){return e.user=r.data,e.edit=!1,a.hide()})["catch"](function(e){return i.error("Erro ao buscar usuários. Por favor, atualize a página."),a.hide()}):l.getAll().then(function(r){return e.users=n("orderBy")(r.data,"-created"),a.hide()})["catch"](function(e){return i.error("Erro ao buscar usuários. Por favor, atualize a página."),a.hide()}),e.canEdit=function(){return e.edit=!0},e.saveOrUpdate=function(){return r.forms.user.$valid?(a.show(),l.saveOrUpdate(e.user).then(function(e){return a.hide(),o.go("dashboard.users")})["catch"](function(e){return i.error("Erro ao criar/editar usuário. Por favor, tente novamente."),a.hide()})):void i.error("Preencha todos os dados obrigatórios.")},e.doDelete=function(r){var o;return o=e.users[r],o._id!==u.getCode()&&(a.show(),l["delete"](o._id).then(function(o){return i.success("Usuário deletado com sucesso!"),e.users.splice(r,1),a.hide()})["catch"](function(e){return i.error("Erro ao deletar usuário. Por favor, tente novamente."),a.hide()}))}}]);
//# sourceMappingURL=app.min.js.map
