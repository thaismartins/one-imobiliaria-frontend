"use strict";angular.module("oneImobiliaria",["ui.router","ui.utils.masks","ui.slider"]).run(["$rootScope","$state","RESOURCES","storage","UserService",function(e,r,t,o,n){return e.error=!1,e.success=!1,e.loading=!1,e.fileUrl=t.API_URL+"/",e.page="",e.name="",e.showMenu=!1,e.showSubmenu=!1,e.appTitle="One Consultoria Imobiliária",e.forms={},e.doLogout=function(){return n.doLogout()},e.toggleMenu=function(){return e.showMenu=!e.showMenu},e.toggleSubmenu=function(){return e.showSubmenu=!e.showSubmenu},e.$on("$stateChangeSuccess",function(){var t;if(t=r.current.name.split("."),e.page=t[1]||"",e.group=o.getGroup(),e.name=o.getName(),e.error=!1,e.success=!1,e.loading=!1,e.showMenu=!1,e.showSubmenu=!1,r.current.requiredLogin&&!n.isLogged()&&n.doLogout(),!r.current.requiredLogin&&n.isLogged()&&r.go("dashboard.home"),"users"===e.page&&"admin"!==e.group)return r.go("dashboard.home")})}]).constant("RESOURCES",{API_URL:"http://desenv.doisoitosete.com:3000/api"}),angular.module("oneImobiliaria").config(["$stateProvider","$httpProvider","$urlRouterProvider",function(e,r,t){return e.state("login",{url:"/login",views:{main:{templateUrl:"app/views/login/index.html",controller:"LoginCtrl"},"error@login":{templateUrl:"app/views/error.html"}},requiredLogin:!1}).state("dashboard",{url:"/dashboard","abstract":!0,views:{main:{},header:{templateUrl:"app/views/header.html"},footer:{templateUrl:"app/views/footer.html"}},requiredLogin:!0}).state("dashboard.home",{url:"/home",views:{"main@":{templateUrl:"app/views/home/index.html"}},requiredLogin:!0}).state("dashboard.users",{url:"/users",views:{"main@":{templateUrl:"app/views/users/index.html",controller:"UsersCtrl"},"submenu@dashboard.users":{templateUrl:"app/views/users/submenu.html"},"error@dashboard.users":{templateUrl:"app/views/error.html"},"success@dashboard.users":{templateUrl:"app/views/success.html"},"loading@dashboard.users":{templateUrl:"app/views/loading.html"}},requiredLogin:!0}).state("dashboard.users.new",{url:"/new",views:{"main@":{templateUrl:"app/views/users/form.html",controller:"UsersCtrl"},"error@dashboard.users.new":{templateUrl:"app/views/error.html"},"loading@dashboard.users.new":{templateUrl:"app/views/loading.html"}},requiredLogin:!0}).state("dashboard.users.edit",{url:"/edit/:id",views:{"main@":{templateUrl:"app/views/users/form.html",controller:"UsersCtrl"},"error@dashboard.users.edit":{templateUrl:"app/views/error.html"},"loading@dashboard.users.edit":{templateUrl:"app/views/loading.html"}},requiredLogin:!0}).state("dashboard.clients",{url:"/clients",views:{"main@":{templateUrl:"app/views/clients/index.html",controller:"ClientsCtrl"},"submenu@dashboard.clients":{templateUrl:"app/views/clients/submenu.html"},"error@dashboard.clients":{templateUrl:"app/views/error.html"},"success@dashboard.clients":{templateUrl:"app/views/success.html"},"loading@dashboard.clients":{templateUrl:"app/views/loading.html"}},requiredLogin:!0}).state("dashboard.clients.new",{url:"/new",views:{"main@":{templateUrl:"app/views/clients/form.html",controller:"ClientsCtrl"},"error@dashboard.clients.new":{templateUrl:"app/views/error.html"},"loading@dashboard.clients.new":{templateUrl:"app/views/loading.html"}},requiredLogin:!0}).state("dashboard.clients.edit",{url:"/edit/:id",views:{"main@":{templateUrl:"app/views/clients/form.html",controller:"ClientsCtrl"},"error@dashboard.clients.edit":{templateUrl:"app/views/error.html"},"loading@dashboard.users.edit":{templateUrl:"app/views/loading.html"}},requiredLogin:!0}).state("dashboard.properties",{url:"/properties",views:{"main@":{templateUrl:"app/views/properties/index.html",controller:"PropertiesCtrl"},"submenu@dashboard.properties":{templateUrl:"app/views/properties/submenu.html"},"error@dashboard.properties":{templateUrl:"app/views/error.html"},"success@dashboard.properties":{templateUrl:"app/views/success.html"},"loading@dashboard.properties":{templateUrl:"app/views/loading.html"}},requiredLogin:!0}).state("dashboard.properties.new",{url:"/new",views:{"main@":{templateUrl:"app/views/properties/form.html",controller:"PropertiesCtrl"},"submenu@dashboard.properties.new":{templateUrl:"app/views/properties/form-submenu.html"},"property@dashboard.properties.new":{templateUrl:"app/views/properties/property.html"},"interest@dashboard.properties.new":{templateUrl:"app/views/properties/interest.html"},"error@dashboard.properties.new":{templateUrl:"app/views/error.html"},"loading@dashboard.properties.new":{templateUrl:"app/views/loading.html"}},requiredLogin:!0}).state("dashboard.properties.edit",{url:"/edit/:id",views:{"main@":{templateUrl:"app/views/properties/form.html",controller:"PropertiesCtrl"},"submenu@dashboard.properties.edit":{templateUrl:"app/views/properties/form-submenu.html"},"property@dashboard.properties.edit":{templateUrl:"app/views/properties/property.html"},"interest@dashboard.properties.edit":{templateUrl:"app/views/properties/interest.html"},"error@dashboard.properties.edit":{templateUrl:"app/views/error.html"},"loading@dashboard.properties.edit":{templateUrl:"app/views/loading.html"}},requiredLogin:!0}).state("dashboard.account",{url:"/account",views:{"main@":{templateUrl:"app/views/account/form.html",controller:"AccountCtrl"},"error@dashboard.account":{templateUrl:"app/views/error.html"},"loading@dashboard.account":{templateUrl:"app/views/loading.html"}},requiredLogin:!0}),t.otherwise("/login"),r.interceptors.push("sessionInjector"),r.defaults.useXDomain=!0,r.defaults.headers.common["Content-Type"]="application/json",delete r.defaults.headers.common["X-Requested-With"]}]),angular.module("oneImobiliaria").service("ClientService",["$http","$state","RESOURCES",function(e,r,t){var o;return o=t.API_URL+"/clients",{create:function(r){return e.post(o,r)},update:function(r){return e.put(o+"/"+r._id,r)},saveOrUpdate:function(e){return e._id?this.update(e):this.create(e)},getAll:function(){return e.get(o)},get:function(r){return e.get(o+"/"+r)},"delete":function(r){return e["delete"](o+"/"+r)}}}]),angular.module("oneImobiliaria").service("$loading",["$rootScope",function(e){return{show:function(){return e.loading=!0},hide:function(){return e.loading=!1}}}]),angular.module("oneImobiliaria").service("LocationService",["$http","$state","RESOURCES",function(e,r,t){var o;return o=t.API_URL+"/cities",{getAll:function(){return e.get(o)},getAllStates:function(){return e.get(o+"/states")},getCitiesByState:function(r){return e.get(o+"/states/"+r)}}}]),angular.module("oneImobiliaria").service("$logger",["$rootScope",function(e){return{clean:function(){return e.success=!1,e.error=!1,e.modalError=!1},error:function(r){return this.clean(),e.error=r},modalError:function(r){return this.clean(),e.modalError=r},success:function(r){return this.clean(),e.success=r}}}]),angular.module("oneImobiliaria").service("PropertyTypeService",function(){var e;return e=[{title:"Apartamento",code:"apartament"},{title:"Casa",code:"house"},{title:"Terreno",code:"land"},{title:"Casa",code:"house"},{title:"Carro",code:"car"}],{getAll:function(){return e}}}),angular.module("oneImobiliaria").service("PropertyService",["$http","$state","RESOURCES",function(e,r,t){var o;return o=t.API_URL+"/properties",{create:function(r){return e.post(o,r)},update:function(r){return e.put(o+"/"+r._id,r)},saveOrUpdate:function(e){return e._id?this.update(e):this.create(e)},getAll:function(){return e.get(o)},get:function(r){return e.get(o+"/"+r)},"delete":function(r){return e["delete"](o+"/"+r)}}}]),angular.module("oneImobiliaria").service("sessionInjector",["storage",function(e){var r;return r=function(e){return e.url.indexOf("auth")>-1||e.url.indexOf("remember")>-1},{request:function(t){return r(t)||(t.headers["x-access-token"]=e.getSessionToken()),t}}}]),angular.module("oneImobiliaria").service("storage",function(){return{isLogged:function(){return null!==localStorage.getItem("x-code-one")&&null!==localStorage.getItem("code-one")},setCodes:function(e){return localStorage.setItem("x-code-one",e.token),localStorage.setItem("code-one",e.code),localStorage.setItem("group-one",e.type),localStorage.setItem("name-one",e.name)},updateToken:function(e){return localStorage.setItem("x-code-one",e)},getSessionToken:function(){return localStorage.getItem("x-code-one")},getCode:function(){return localStorage.getItem("code-one")},getName:function(){return localStorage.getItem("name-one")||""},getGroup:function(){return localStorage.getItem("group-one")||""},clean:function(){return localStorage.removeItem("x-code-one"),localStorage.removeItem("code-one"),localStorage.removeItem("group-one"),localStorage.removeItem("name-one")}}}),angular.module("oneImobiliaria").service("UserGroupService",function(){var e;return e=[{title:"Administrador(a)",code:"admin"},{title:"Corretor(a)",code:"broker"}],{getAll:function(){return e}}}),angular.module("oneImobiliaria").service("UserService",["$http","$state","storage","RESOURCES",function(e,r,t,o){var n;return n=o.API_URL+"/accounts",{isLogged:function(){return t.isLogged()},doLogin:function(r){return e.post(n+"/auth",r)},doLogout:function(){t.clean(),r.go("login")},create:function(r){return e.post(n,r)},update:function(r){return e.put(n+"/"+r._id,r)},saveOrUpdate:function(e){return e._id?this.update(e):this.create(e)},getAll:function(){return e.get(n)},get:function(r){return e.get(n+"/"+r)},getMyAccount:function(){return e.get(n+"/"+t.getCode())},"delete":function(r){return e["delete"](n+"/"+r)}}}]),angular.module("oneImobiliaria").filter("address",function(){return function(e){var r;return null==e||null==e.street&&null==e.number&&null==e.complement?"Indefinido":(r="",null!=e.street&&(r+=e.street),null!=e.number&&(r+=", "+e.number),null!=e.complement&&(r+=" - "+e.complement),r)}}),angular.module("oneImobiliaria").filter("dateBr",function(){return function(e){var r;return null==e?"":(r=e.split("T"),moment(r[0]).format("DD/MM/YYYY"))}}),angular.module("oneImobiliaria").filter("dateTimeBr",function(){return function(e){return null==e?"":(moment.locale("pt-br"),moment(e).calendar(null,{sameElse:"DD/MM/YYYY - H:mm"}))}}),angular.module("oneImobiliaria").filter("decimals",function(){return function(e){return null==e?"":e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.")}}),angular.module("oneImobiliaria").filter("firstName",function(){return function(e){var r;return null==e||""===e?"":(r=e.split(" "),r[0])}}),angular.module("oneImobiliaria").filter("meters",function(){return function(e){return null!=e&&""!==e||(e="0"),e+" m²"}}),angular.module("oneImobiliaria").filter("orderByString",function(){return function(e,r,t){var o;return o=e.sort(function(e,t){return angular.isUndefined(r)&&e.localeCompare(t),e[r].localeCompare(t[r])}),t?o.reverse():o}}),angular.module("oneImobiliaria").filter("phoneBr",function(){return function(e){return null==e?"":10===e.length?e.replace(/(\d{2})(\d{4})(\d{4})/g,"($1) $2-$3"):e.replace(/(\d{2})(\d{5})(\d{4})/g,"($1) $2-$3")}}),angular.module("oneImobiliaria").filter("propertyType",["PropertyTypeService",function(e){return function(r){var t,o;return null==r||""===r?"":(t=e.getAll(),o="",t.map(function(e){if(e.code===r)return o=e.title}),o)}}]),angular.module("oneImobiliaria").filter("range",function(){return function(e){var r,t,o,n;for(n=[],r=t=1,o=e+1;t<o;r=t+=1)n.push(r);return n}}),angular.module("oneImobiliaria").filter("typesToText",function(){return function(e){var r,t,o,n;if(!(null!=e&&e.length>0))return"Indefinido";for(t={apart:"Apartamento",land:"Tereno",car:"Carro",house:"Case"},r=0,o=e.length;r<o;r++)n=e[r],console.log(n);return e}}),angular.module("oneImobiliaria").filter("groupName",["UserGroupService",function(e){return function(r){var t,o;return null==r||""===r?"":(t=e.getAll(),o="",t.map(function(e){if(e.code===r)return o=e.title}),o)}}]),angular.module("oneImobiliaria").filter("yesOrNo",function(){return function(e){return e?"Sim":"Não"}}),angular.module("oneImobiliaria").directive("decimals",["$parse",function(e){return{require:"?ngModel",scope:{ngModel:"="},restrict:"A",link:function(r,t,o,n){var i,a;return a=function(e){return null==e?"":e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.")},n.$formatters.push(function(e){return a(e)}),n.$parsers.push(function(e){return a(e)}),i=function(){var t;return t=a(n.$modelValue),e(o.ngModel).assign(r,t),n.$viewValue=t,n.$render()},t.bind("keyup",i)}}}]),angular.module("oneImobiliaria").directive("file",function(){return{require:"ngModel",restrict:"A",link:function(e,r,t,o){var n;return n=function(r){var t,n;return n=r.target.files,t=n[0],o.$setViewValue(t),e.$apply()},r.bind("change",n)}}}),angular.module("oneImobiliaria").directive("meters",["$parse",function(e){return{require:"?ngModel",scope:{ngModel:"="},restrict:"A",link:function(r,t,o,n){var i,a;return console.log(n.$modelValue),a=function(e){return null==e&&(e=0),e=e.toString().replace("m²",""),e=e.toString().replace(/\D/g,""),e+"m²"},n.$formatters.push(function(e){return console.log(e),a(e)}),n.$parsers.push(function(e){return e.toString().replace("m²","")}),i=function(){var t;return t=a(n.$modelValue),console.log(t),e(o.ngModel).assign(r,t),n.$viewValue=t,n.$render()},t.bind("keyup",i)}}}]),angular.module("oneImobiliaria").controller("AccountCtrl",["$scope","$rootScope","$loading","$logger","storage","UserService",function(e,r,t,o,n,i){return e.user={},e.edit=!1,t.show(),i.getMyAccount().then(function(r){return e.user=r.data,t.hide()})["catch"](function(e){return o.error("Erro ao buscar sua conta. Por favor, atualize a página."),t.hide()}),e.canEdit=function(){return e.edit=!0},e.doUpdate=function(){return r.forms.user.$valid?(console.log(e.user),t.show(),i.update(e.user).then(function(e){return o.success("Sua conta foi atualizada com sucesso!"),n.updateToken(e.data.token),t.hide()})["catch"](function(e){return o.error("Erro ao editar sua conta. Por favor, tente novamente."),t.hide()})):void o.error("Preencha todos os dados obrigatórios.")}}]),angular.module("oneImobiliaria").controller("ClientsCtrl",["$scope","$rootScope","$state","$stateParams","$filter","$loading","$logger","storage","ClientService",function(e,r,t,o,n,i,a,l,s){return e.client={},e.clients=[],e.edit=!0,i.show(),o.id?s.get(o.id).then(function(r){return e.client=r.data,e.edit=!1,i.hide()})["catch"](function(e){return a.error("Erro ao buscar clientes. Por favor, atualize a página."),i.hide()}):s.getAll().then(function(r){return e.clients=n("orderBy")(r.data,"-created"),i.hide()})["catch"](function(e){return a.error("Erro ao buscar clientes. Por favor, atualize a página."),i.hide()}),e.canEdit=function(){return e.edit=!0},e.saveOrUpdate=function(){return r.forms.client.$valid?(i.show(),s.saveOrUpdate(e.client).then(function(e){return i.hide(),t.go("dashboard.clients")})["catch"](function(e){return a.error("Erro ao criar/editar cliente. Por favor, tente novamente."),i.hide()})):void a.error("Preencha todos os dados obrigatórios.")},e.doDelete=function(r){var t;return t=e.clients[r],t._id!==l.getCode()&&(i.show(),s["delete"](t._id).then(function(t){return a.success("Cliente excluído com sucesso!"),e.clients.splice(r,1),i.hide()})["catch"](function(e){return a.error("Erro ao excluir cliente. Por favor, tente novamente."),i.hide()}))}}]),angular.module("oneImobiliaria").controller("LoginCtrl",["$scope","$rootScope","$state","$logger","storage","UserService",function(e,r,t,o,n,i){return e.user={},e.doLogin=function(){return r.forms.login.$valid?(e.user.origin="admin",i.doLogin(e.user).then(function(e){return n.setCodes(e.data),t.go("dashboard.home")})["catch"](function(e){return o.error("Usuário e/ou senha inválido(s).")})):void o.error("Preencha todos os dados obrigatórios.")}}]),angular.module("oneImobiliaria").controller("PropertiesCtrl",["$scope","$rootScope","$state","$stateParams","$filter","$loading","$logger","storage","PropertyService","LocationService","ClientService",function(e,r,t,o,n,i,a,l,s,u,p){var c,d,m;return e.property={payments:[],interest:{types:[],allMeters:[10,500],allVacancies:[0,10],allFloors:[1,30],allValues:[1e3,5e6],allIptus:[1e3,15e3],allCondominiums:[1e3,5e5],allLocations:[1e3,5e4]}},e.properties=[],e.cities=[],e.states=[],e.clients=[],c=[],e.edit=!0,i.show(),o.id?s.get(o.id).then(function(r){return e.property=r.data,d(),u.getAllStates()}).then(function(r){return e.states=r.data.sort(),u.getCitiesByState(e.property.address.state)}).then(function(r){var t;return t=n("orderByString")(r.data,"name"),e.cities=t,c[e.property.address.state]=t,p.getAll()}).then(function(r){return e.clients=n("orderByString")(r.data,"name"),e.edit=!1,i.hide()})["catch"](function(e){return a.error("Erro ao buscar imóveis. Por favor, atualize a página."),i.hide()}):s.getAll().then(function(r){return e.properties=n("orderBy")(r.data,"-created"),u.getAllStates()}).then(function(r){return e.states=r.data.sort(),p.getAll()}).then(function(r){return e.clients=n("orderByString")(r.data,"name"),i.hide()})["catch"](function(e){return a.error("Erro ao buscar imóveis. Por favor, atualize a página."),i.hide()}),e.showCities=function(r){return null!=c[r]?(e.cities=c[r],!1):(i.show(),u.getCitiesByState(r).then(function(t){var o;return o=n("orderByString")(t.data,"name"),e.cities=o,c[r]=o,i.hide()})["catch"](function(){return i.hide()}))},e.canEdit=function(){return e.edit=!0},e.saveOrUpdate=function(){return r.forms.property.$valid?(i.show(),m(),s.saveOrUpdate(e.property).then(function(e){return i.hide(),t.go("dashboard.properties")})["catch"](function(e){return 8===e.data.code?a.error("Verifique o endereço digitado. Não foi possível validar esta informação."):a.error("Erro ao criar/editar imóvel. Por favor, tente novamente."),i.hide()})):void a.error("Preencha todos os dados obrigatórios.")},e.doDelete=function(r){var t;return t=e.properties[r],t._id!==l.getCode()&&(i.show(),s["delete"](t._id).then(function(t){return a.success("Imóvel excluído com sucesso!"),e.properties.splice(r,1),i.hide()})["catch"](function(e){return a.error("Erro ao excluir imóvel. Por favor, tente novamente."),i.hide()}))},e.doUploadCSV=function(){return console.log("Entrou...."),console.log(e.csv)},d=function(){if(e.property.interest.allMeters=[10,500],e.property.interest.allVacancies=[0,10],e.property.interest.allFloors=[1,30],e.property.interest.allValues=[1e3,5e6],e.property.interest.allIptus=[1e3,15e3],e.property.interest.allCondominiums=[1e3,5e5],e.property.interest.allLocations=[1e3,5e4],null!=e.property.interest.types&&(e.property.interest.types=[]),null!=e.property.interest.meters&&(e.property.interest.allMeters[0]=e.property.interest.meters.min,e.property.interest.allMeters[1]=e.property.interest.meters.max),null!=e.property.interest.condominium&&(e.property.interest.allCondominiums[0]=e.property.interest.condominium.min,e.property.interest.allCondominiums[1]=e.property.interest.condominium.max),null!=e.property.interest.vacancy&&(e.property.interest.allVacancies[0]=e.property.interest.vacancy.min,e.property.interest.allVacancies[1]=e.property.interest.vacancy.max),null!=e.property.interest.floor&&(e.property.interest.allFloors[0]=e.property.interest.floor.min,e.property.interest.allFloors[1]=e.property.interest.floor.max),null!=e.property.interest.value&&(e.property.interest.allValues[0]=e.property.interest.value.min,e.property.interest.allValues[1]=e.property.interest.value.max),null!=e.property.interest.iptu&&(e.property.interest.allIptus[0]=e.property.interest.iptu.min,e.property.interest.allIptus[1]=e.property.interest.iptu.max),null!=e.property.interest.location)return e.property.interest.allLocations[0]=e.property.interest.location.min,e.property.interest.allLocations[1]=e.property.interest.location.max},m=function(){return e.property.interest.meters={min:e.property.interest.allMeters[0],max:e.property.interest.allMeters[1]},delete e.property.interest.allMeters,e.property.interest.condominium={min:e.property.interest.allCondominiums[0],max:e.property.interest.allCondominiums[1]},delete e.property.interest.allCondominiums,e.property.interest.vacancy={min:e.property.interest.allVacancies[0],max:e.property.interest.allVacancies[1]},delete e.property.interest.allVacancies,e.property.interest.floor={min:e.property.interest.allFloors[0],max:e.property.interest.allFloors[1]},delete e.property.interest.allFloors,e.property.interest.value={min:e.property.interest.allValues[0],max:e.property.interest.allValues[1]},delete e.property.interest.allValues,e.property.interest.iptu={min:e.property.interest.allIptus[0],max:e.property.interest.allIptus[1]},delete e.property.interest.allIptus,e.property.interest.location={min:e.property.interest.allLocations[0],max:e.property.interest.allLocations[1]},delete e.property.interest.allLocations}}]),angular.module("oneImobiliaria").controller("UsersCtrl",["$scope","$rootScope","$state","$stateParams","$filter","$loading","$logger","storage","UserGroupService","UserService",function(e,r,t,o,n,i,a,l,s,u){return e.user={},e.users=[],e.groups=s.getAll(),e.edit=!0,i.show(),o.id?u.get(o.id).then(function(r){return e.user=r.data,e.edit=!1,i.hide()})["catch"](function(e){return a.error("Erro ao buscar usuários. Por favor, atualize a página."),i.hide()}):u.getAll().then(function(r){return e.users=n("orderBy")(r.data,"-created"),i.hide()})["catch"](function(e){return a.error("Erro ao buscar usuários. Por favor, atualize a página."),i.hide()}),e.canEdit=function(){return e.edit=!0},e.saveOrUpdate=function(){return r.forms.user.$valid?(i.show(),u.saveOrUpdate(e.user).then(function(e){return i.hide(),t.go("dashboard.users")})["catch"](function(e){return a.error("Erro ao criar/editar usuário. Por favor, tente novamente."),i.hide()})):void a.error("Preencha todos os dados obrigatórios.")},e.doDelete=function(r){var t;return t=e.users[r],t._id!==l.getCode()&&(i.show(),u["delete"](t._id).then(function(t){return a.success("Usuário excluído com sucesso!"),e.users.splice(r,1),i.hide()})["catch"](function(e){return a.error("Erro ao excluir usuário. Por favor, tente novamente."),i.hide()}))}}]);
//# sourceMappingURL=app.min.js.map
